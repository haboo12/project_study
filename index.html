<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For better study ğŸ“š</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        /* ë‹¤í¬ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        body.dark-mode {
            background-color: #2c3e50;
            color: #ecf0f1;
        }
        body.dark-mode .header {
            background-color: #34495e;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        body.dark-mode .header .logo {
            color: #8aff8a;
        }
        body.dark-mode .search-section,
        body.dark-mode .video-item,
        body.dark-mode .modal-content,
        body.dark-mode .post-item,
        body.dark-mode .comment-item,
        body.dark-mode .recommended-content-section { /* ì¶”ì²œ ì»¨í…ì¸  ì„¹ì…˜ ì¶”ê°€ */
            background-color: #34495e;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        body.dark-mode .search-section h2,
        body.dark-mode .modal-header h3,
        body.dark-mode .video-item .details h3,
        body.dark-mode .post-item h4,
        body.dark-mode #viewPostContent h3,
        body.dark-mode .comments-section h4,
        body.dark-mode .recommended-content-section h2 { /* ì¶”ì²œ ì»¨í…ì¸  ì„¹ì…˜ ì œëª© ì¶”ê°€ */
            color: #8aff8a; /* ë°ì€ ë…¹ìƒ‰ */
        }
        body.dark-mode .search-bar input,
        body.dark-mode #chatInput,
        body.dark-mode #communitySearchQuery,
        body.dark-mode #postTitle,
        body.dark-mode #postContent,
        body.dark-mode #commentInput {
            background-color: #4a6572;
            color: #ecf0f1;
            border-color: #5d7e8b;
        }
        body.dark-mode .search-bar input:focus {
            border-color: #8aff8a;
        }
        body.dark-mode .chat-message.ai {
            background-color: #4a6572;
            border-color: #5d7e8b;
        }
        body.dark-mode .chat-message.user {
            background-color: #6a964a;
        }
        body.dark-mode .close-button {
            color: #bbb;
        }
        body.dark-mode .close-button:hover,
        body.dark-mode .close-button:focus {
            color: #fff;
        }
        body.dark-mode .video-item .details a,
        body.dark-mode .recommended-content-section ul li a { /* ì¶”ì²œ ì»¨í…ì¸  ë§í¬ ìƒ‰ìƒ ì¶”ê°€ */
            color: #8aff8a;
        }
        body.dark-mode .post-item p,
        body.dark-mode .post-meta,
        body.dark-mode #viewPostContent p,
        body.dark-mode .recommended-content-section p { /* ì¶”ì²œ ì»¨í…ì¸  ì„¤ëª… ìƒ‰ìƒ ì¶”ê°€ */
            color: #bdc3c7;
        }
        body.dark-mode .comment-item strong {
            color: #ecf0f1;
        }
        body.dark-mode #commentsList div[style*="ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤"] {
            color: #bdc3c7 !important;
        }
        body.dark-mode #communityContent div[style*="ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤"] {
            color: #bdc3c7 !important;
        }

        /* ìƒë‹¨ ë°” */
        .header {
            background-color: #fff;
            padding: 15px 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-sizing: border-box;
        }
        .header .logo {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }
        .header .top-right-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .header .dark-mode-toggle {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            outline: none;
            color: #333; /* Default light mode color */
            transition: color 0.3s;
        }
        body.dark-mode .header .dark-mode-toggle {
            color: #ecf0f1; /* Dark mode color */
        }

        /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 100px 20px 20px;
            text-align: center;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        /* ê²€ìƒ‰ ì„¹ì…˜ */
        .search-section {
            background-color: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 800px;
            margin-bottom: 30px;
        }
        .search-section h2 {
            font-size: 28px;
            color: #4CAF50;
            margin-bottom: 20px;
        }
        .search-bar {
            display: flex;
            justify-content: center;
            width: 100%;
        }
        .search-bar input {
            width: 70%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 18px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        .search-bar input:focus {
            border-color: #4CAF50;
        }
        .search-bar button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            margin-left: 10px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s ease;
        }
        .search-bar button:hover {
            background-color: #45a049;
        }

        /* ê²€ìƒ‰ ê²°ê³¼ */
        #searchResults {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            width: 100%;
            margin-top: 20px;
            text-align: left;
        }
        .video-item {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s ease;
        }
        .video-item:hover {
            transform: translateY(-5px);
        }
        .video-item img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        .video-item .details {
            padding: 15px;
        }
        .video-item .details h3 {
            font-size: 18px;
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
            line-height: 1.4;
        }
        .video-item .details p {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        .video-item .details a {
            color: #4CAF50;
            text-decoration: none;
            font-weight: bold;
        }
        .video-item .details a:hover {
            text-decoration: underline;
        }

        /* ì¶”ì²œ ì»¨í…ì¸  ì„¹ì…˜ */
        .recommended-content-section {
            background-color: #fff;
            padding: 30px 40px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 800px;
            margin-top: 30px;
            text-align: left;
        }
        .recommended-content-section h2 {
            font-size: 24px;
            color: #2196F3; /* íŒŒë€ìƒ‰ ê³„ì—´ë¡œ ë³€ê²½ */
            margin-bottom: 20px;
            text-align: center;
        }
        .recommended-content-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .recommended-content-section ul li {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .recommended-content-section ul li:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .recommended-content-section ul li a {
            font-size: 18px;
            color: #4CAF50;
            text-decoration: none;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        .recommended-content-section ul li a:hover {
            text-decoration: underline;
        }
        .recommended-content-section ul li p {
            font-size: 15px;
            color: #666;
            margin: 0;
        }


        /* í”Œë¡œíŒ… ë²„íŠ¼ */
        .floating-buttons {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }
        .floating-buttons button {
            background-color: #FFC107; /* AI ì±„íŒ… ë²„íŠ¼ ìƒ‰ìƒ */
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .floating-buttons button:hover {
            background-color: #FFA000;
            transform: scale(1.05);
        }
        .floating-buttons .community-button {
            background-color: #2196F3; /* ì»¤ë®¤ë‹ˆí‹° ë²„íŠ¼ ìƒ‰ìƒ */
        }
        .floating-buttons .community-button:hover {
            background-color: #1976D2;
        }

        /* ëª¨ë‹¬ (ì±„íŒ…, ì»¤ë®¤ë‹ˆí‹°) */
        .modal {
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 600px;
            position: relative;
            display: flex;
            flex-direction: column;
            max-height: 80vh;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .modal-header h3 {
            margin: 0;
            color: #4CAF50;
        }
        .close-button {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
        }

        /* ì±„íŒ… ëª¨ë‹¬ */
        #chatBox {
            flex-grow: 1;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #e9ebee;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .chat-message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 15px;
            word-wrap: break-word;
        }
        .chat-message.user {
            background-color: #DCF8C6;
            align-self: flex-end;
        }
        .chat-message.ai {
            background-color: #fff;
            align-self: flex-start;
            border: 1px solid #eee;
        }
        /* AI ë©”ì‹œì§€ ë‚´ë¶€ì˜ ë³¼ë“œì²´ ìŠ¤íƒ€ì¼ */
        .chat-message.ai strong {
            font-weight: bold;
            color: #333; /* ë‹¤í¬ ëª¨ë“œì—ì„œë„ ì˜ ë³´ì´ë„ë¡ */
        }
        body.dark-mode .chat-message.ai strong {
            color: #ecf0f1;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
        }
        .chat-input-area input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 16px;
        }
        .chat-input-area button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        .chat-input-area button:hover {
            background-color: #45a049;
        }

        /* ì»¤ë®¤ë‹ˆí‹° ëª¨ë‹¬ */
        #communityContent {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 10px; /* ìŠ¤í¬ë¡¤ë°” ê³µê°„ */
        }
        .community-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .community-controls .search-input {
            display: flex;
            gap: 5px;
        }
        .community-controls .search-input input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            width: 200px;
        }
        .community-controls .search-input button {
            background-color: #607D8B;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        .community-controls .search-input button:hover {
            background-color: #455A64;
        }
        .community-controls .write-button button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        .community-controls .write-button button:hover {
            background-color: #1976D2;
        }
        .post-item {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .post-item:hover {
            background-color: #f0f0f0;
        }
        .post-item h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
            font-size: 18px;
        }
        .post-item p {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }
        .post-meta {
            font-size: 12px;
            color: #999;
            margin-top: 10px;
            text-align: right;
        }

        /* ê¸€ì“°ê¸° ëª¨ë‹¬ */
        #writePostModal .modal-content {
            max-width: 700px;
        }
        #writePostForm label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        #writePostForm input[type="text"],
        #writePostForm textarea {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        #writePostForm textarea {
            min-height: 150px;
            resize: vertical;
        }
        #writePostForm button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s ease;
        }
        #writePostForm button:hover {
            background-color: #45a049;
        }

        /* ê²Œì‹œë¬¼ ìƒì„¸ ëª¨ë‹¬ */
        #viewPostModal .modal-content {
            max-width: 700px;
        }
        #viewPostContent h3 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }
        #viewPostContent p {
            font-size: 16px;
            line-height: 1.6;
            color: #555;
            margin-bottom: 20px;
        }
        #viewPostContent .post-meta {
            text-align: left;
            margin-bottom: 15px;
        }
        .post-actions button {
            background-color: #FFC107;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            transition: background-color 0.3s ease;
        }
        .post-actions button:hover {
            background-color: #FFA000;
        }
        .comments-section {
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .comments-section h4 {
            margin-top: 0;
            color: #4CAF50;
        }
        .comment-item {
            background-color: #f0f2f5;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .comment-item strong {
            color: #333;
        }
        .comment-input-area {
            display: flex;
            margin-top: 15px;
        }
        .comment-input-area input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            margin-right: 10px;
        }
        .comment-input-area button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
        }
        .comment-input-area button:hover {
            background-color: #1976D2;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">For better study ğŸ“š</div>
        <div class="top-right-controls">
            <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                <span id="darkModeIcon">ğŸŒ™</span>
            </button>
        </div>
    </header>

    <main class="main-content">
        <section class="search-section">
            <h2>ê¶ê¸ˆí•œ ê±¸ ë¬¼ì–´ ë³´ì„¸ìš” ğŸ§</h2>
            <div class="search-bar">
                <input type="text" id="searchQuery" placeholder="ì˜ˆ: ë¯¸ë¶„ ì ë¶„ ê°œë…, íŒŒì´ì¬ ê¸°ì´ˆ">
                <button onclick="searchYouTube()">ê²€ìƒ‰</button>
            </div>
            <div id="searchResults">
                </div>
        </section>

        <section class="recommended-content-section">
            <h2>ì¶”ì²œ ì»¨í…ì¸  ğŸŒŸ</h2>
            <ul>
                <li>
                    <a href="https://www.youtube.com/watch?v=5" target="_blank">íš¨ìœ¨ì ì¸ ê³µë¶€ë²• ê°€ì´ë“œ</a>
                    <p>ì„±ì ì„ ì˜¬ë¦¬ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” ë‹¤ì–‘í•œ ê³µë¶€ ì „ëµì„ ì•Œë ¤ì¤ë‹ˆë‹¤.</p>
                </li>
                <li>
                    <a href="https://m.blog.naver.com/mindmapmath/221778028801" target="_blank">ë¡œê·¸í•¨ìˆ˜, ì‰½ê²Œ ì´í•´í•˜ê¸°</a>
                    <p>ë³µì¡í•˜ê²Œ ëŠê»´ì§€ëŠ” ë¡œê·¸í•¨ìˆ˜ì˜ ê°œë…ê³¼ ì›ë¦¬ë¥¼ ëª…í™•í•˜ê²Œ ì„¤ëª…í•©ë‹ˆë‹¤.</p>
                </li>
                <li>
                    <a href="https://m.blog.naver.com/PostView.naver?blogId=lagrange0115&logNo=223465686475" target="_blank">ê°€ì†ë„ ê°œë… ì™„ì „ ì •ë³µ</a>
                    <p>ë¬¼ë¦¬í•™ì˜ ê¸°ë³¸ì¸ ê°€ì†ë„ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ê³ , ì˜ˆì‹œë¥¼ í†µí•´ ì´í•´ë¥¼ ë•ìŠµë‹ˆë‹¤.</p>
                </li>
            </ul>
        </section>

    </main>

    <div class="floating-buttons">
        <button class="community-button" id="openCommunityModalBtn">ğŸ“</button>
        <button id="openChatModalBtn">ğŸ¤–</button>
    </div>

    <div id="chatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>AI ì±—ë´‡ ğŸ¤–</h3>
                <span class="close-button" onclick="closeModal('chatModal')">Ã—</span>
            </div>
            <div id="chatBox">
                <div class="chat-message ai">ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chatInput" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...">
                <button onclick="sendChatMessage()">ì „ì†¡</button>
            </div>
        </div>
    </div>

    <div id="communityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ì»¤ë®¤ë‹ˆí‹° ğŸ“</h3>
                <span class="close-button" onclick="closeModal('communityModal')">Ã—</span>
            </div>
            <div class="community-controls">
                <div class="search-input">
                    <input type="text" id="communitySearchQuery" placeholder="ê²Œì‹œê¸€ ê²€ìƒ‰...">
                    <button onclick="filterCommunityPosts()">ê²€ìƒ‰</button>
                </div>
                <div class="write-button">
                    <button onclick="openWritePostModal()">ê¸€ì“°ê¸°</button>
                </div>
            </div>
            <div id="communityContent">
                </div>
        </div>
    </div>

    <div id="writePostModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ìƒˆ ê¸€ ì‘ì„± âœï¸</h3>
                <span class="close-button" onclick="closeModal('writePostModal')">Ã—</span>
            </div>
            <form id="writePostForm">
                <label for="postTitle">ì œëª©:</label>
                <input type="text" id="postTitle" required>

                <label for="postContent">ë‚´ìš©:</label>
                <textarea id="postContent" required></textarea>

                <button type="submit">ì‘ì„± ì™„ë£Œ</button>
            </form>
        </div>
    </div>

    <div id="viewPostModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="viewPostTitle"></h3>
                <span class="close-button" onclick="closeModal('viewPostModal')">Ã—</span>
            </div>
            <div id="viewPostContent">
                <p id="viewPostText"></p>
                <div class="post-meta" id="viewPostMeta"></div>
                <div class="post-actions">
                    <button onclick="likePost()">ğŸ‘ ì¢‹ì•„ìš” (<span id="likeCount">0</span>)</button>
                </div>
                <div class="comments-section">
                    <h4>ëŒ“ê¸€</h4>
                    <div id="commentsList">
                        </div>
                    <div class="comment-input-area">
                        <input type="text" id="commentInput" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”...">
                        <button onclick="addComment()">ëŒ“ê¸€ ë‹¬ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API í‚¤ (í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë…¸ì¶œì— ì£¼ì˜)
        const YOUTUBE_API_KEY = ' ';
        // API í‚¤ëŠ” ì ˆëŒ€ ê³µê°œì ìœ¼ë¡œ ë…¸ì¶œë˜ë©´ ì•ˆ ë©ë‹ˆë‹¤! ì´ ì˜ˆì œëŠ” í•™ìŠµìš©ì…ë‹ˆë‹¤.
        const GEMINI_API_KEY = ' ';
        
        const GEMINI_MODEL_NAME = 'gemini-1.5-flash'; 

        // RAG ê¸°ëŠ¥ì„ ìœ„í•œ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (ê³ ë“±í•™ìƒ ìˆ˜ì¤€ ì„¤ëª…)
        // AIì—ê²Œ ë§ˆí¬ë‹¤ìš´ ë³¼ë“œì²´ ëŒ€ì‹  HTML <strong> íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ëª…ì‹œì ìœ¼ë¡œ ì§€ì‹œí•©ë‹ˆë‹¤.
        const SYSTEM_PROMPT_FOR_HIGH_SCHOOL = `ë‹¹ì‹ ì€ ê³ ë“±í•™ìƒì„ ìœ„í•œ ì¹œì ˆí•˜ê³  ëª…í™•í•œ ê³¼ì™¸ ì„ ìƒë‹˜ì…ë‹ˆë‹¤. ê³ ë“±í•™ìƒì´ í•µì‹¬ ê°œë…ì„ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ë³µì¡í•œ ìš©ì–´ëŠ” í”¼í•˜ê³ , ì¹œìˆ™í•œ ë¹„ìœ ë‚˜ ì˜ˆì‹œë¥¼ ë“¤ì–´ ê°„ê²°í•˜ê³  ëª…í™•í•˜ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”. ë§ˆì¹˜ ì¹œêµ¬ì—ê²Œ ì„¤ëª…í•´ì£¼ë“¯ í¸ì•ˆí•œ ì–´ì¡°ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”. ë¶ˆí•„ìš”í•œ ì „ë¬¸ ìš©ì–´ëŠ” ìµœì†Œí™”í•˜ê³ , ëª¨ë“  ì„¤ëª…ì€ ê³ ë“±í•™ìƒì´ ì´í•´í•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€ìœ¼ë¡œ í•´ì£¼ì„¸ìš”. ì¤‘ìš”í•œ ë‹¨ì–´ëŠ” <strong>ë³¼ë“œì²´</strong>ë¡œ ê°•ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;

        // ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸° í•¨ìˆ˜
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ë‹¤í¬ ëª¨ë“œ í† ê¸€
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('darkModeIcon');
            if (document.body.classList.contains('dark-mode')) {
                icon.textContent = 'â˜€ï¸'; // ë‹¤í¬ ëª¨ë“œì¼ ë•Œ í–‡ë‹˜ ì•„ì´ì½˜
                localStorage.setItem('darkMode', 'enabled');
            } else {
                icon.textContent = 'ğŸŒ™'; // ë¼ì´íŠ¸ ëª¨ë“œì¼ ë•Œ ë‹¬ë‹˜ ì•„ì´ì½˜
                localStorage.setItem('darkMode', 'disabled');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‹¤í¬ ëª¨ë“œ ì„¤ì • ì ìš©
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('darkMode') === 'enabled') {
                toggleDarkMode(); // ë‹¤í¬ ëª¨ë“œ í™œì„±í™” (í† ê¸€ í•¨ìˆ˜ë¡œ ì•„ì´ì½˜ë„ ë³€ê²½)
            }
        });

        // AI ì±„íŒ… ëª¨ë‹¬ ì—´ê¸°
        document.getElementById('openChatModalBtn').addEventListener('click', () => {
            openModal('chatModal');
        });

        // ì»¤ë®¤ë‹ˆí‹° ëª¨ë‹¬ ì—´ê¸°
        document.getElementById('openCommunityModalBtn').addEventListener('click', () => {
            openModal('communityModal');
            loadCommunityPosts(); // ì»¤ë®¤ë‹ˆí‹° ëª¨ë‹¬ ì—´ ë•Œ ê²Œì‹œë¬¼ ëª©ë¡ ë¡œë“œ
        });

        // ì—”í„° í‚¤ë¡œ ê²€ìƒ‰ ì‹¤í–‰
        document.getElementById('searchQuery').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                searchYouTube();
            }
        });

        /**
         * YouTube APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì˜ìƒì„ ê²€ìƒ‰í•˜ê³  ê²°ê³¼ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
         */
        async function searchYouTube() {
            const query = document.getElementById('searchQuery').value;
            const searchResultsDiv = document.getElementById('searchResults');
            searchResultsDiv.innerHTML = '<div>ê²€ìƒ‰ ì¤‘...</div>';

            if (!query) {
                searchResultsDiv.innerHTML = '<div>ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
                return;
            }

            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=10&key=${YOUTUBE_API_KEY}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                searchResultsDiv.innerHTML = ''; // ê¸°ì¡´ ê²°ê³¼ ì§€ìš°ê¸°

                if (data.items && data.items.length > 0) {
                    data.items.forEach(item => {
                        const videoId = item.id.videoId;
                        const title = item.snippet.title;
                        const description = item.snippet.description;
                        const thumbnailUrl = item.snippet.thumbnails.high.url;

                        const videoHtml = `
                            <div class="video-item">
                                <img src="${thumbnailUrl}" alt="${title}">
                                <div class="details">
                                    <h3>${title}</h3>
                                    <p>${description.substring(0, 100)}${description.length > 100 ? '...' : ''}</p>
                                    <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank">ì˜ìƒ ë³´ëŸ¬ê°€ê¸°</a>
                                </div>
                            </div>
                        `;
                        searchResultsDiv.innerHTML += videoHtml;
                    });
                } else {
                    searchResultsDiv.innerHTML = '<div>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            } catch (error) {
                console.error('YouTube ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                searchResultsDiv.innerHTML = '<div>ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>';
            }
        }

        /**
         * Gemini APIë¥¼ ì‚¬ìš©í•˜ì—¬ AI ì±—ë´‡ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ê³  ì‘ë‹µì„ ë°›ìŠµë‹ˆë‹¤.
         */
        async function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const chatBox = document.getElementById('chatBox');
            const userMessage = chatInput.value.trim();

            if (!userMessage) return;

            // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
            const userMsgDiv = document.createElement('div');
            userMsgDiv.classList.add('chat-message', 'user');
            userMsgDiv.textContent = userMessage;
            chatBox.appendChild(userMsgDiv);
            chatBox.scrollTop = chatBox.scrollHeight; // ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ

            chatInput.value = ''; // ì…ë ¥ì°½ ë¹„ìš°ê¸°

            // AI ì‘ë‹µ ëŒ€ê¸° ë©”ì‹œì§€
            const aiLoadingDiv = document.createElement('div');
            aiLoadingDiv.classList.add('chat-message', 'ai');
            aiLoadingDiv.textContent = 'AIê°€ ë‹µë³€ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...';
            chatBox.appendChild(aiLoadingDiv);
            chatBox.scrollTop = chatBox.scrollHeight;

            // RAG (ê³ ë“±í•™ìƒ ìˆ˜ì¤€) í”„ë¡¬í”„íŠ¸ë¥¼ ì‚¬ìš©ì ë©”ì‹œì§€ ì•ì— ì¶”ê°€í•˜ì—¬ ì „ì†¡
            const fullPrompt = SYSTEM_PROMPT_FOR_HIGH_SCHOOL + "\n\nì§ˆë¬¸: " + userMessage;

            const url = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL_NAME}:generateContent?key=${GEMINI_API_KEY}`;
            const requestBody = {
                contents: [{
                    parts: [{
                        text: fullPrompt // ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì™€ ì‚¬ìš©ì ì§ˆë¬¸ì„ í•©ì³ì„œ ë³´ëƒ„
                    }]
                }]
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                const data = await response.json();

                // AI ì‘ë‹µ ëŒ€ê¸° ë©”ì‹œì§€ ì œê±°
                chatBox.removeChild(aiLoadingDiv);

                let aiResponseText = 'ì£„ì†¡í•©ë‹ˆë‹¤. ë‹µë³€ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0]) {
                    aiResponseText = data.candidates[0].content.parts[0].text;
                } else if (data.error) {
                    aiResponseText = `ì˜¤ë¥˜ ë°œìƒ: ${data.error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}. API í‚¤, ëª¨ë¸ ì´ë¦„, ê¶Œí•œì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.`;
                    console.error('Gemini API Error:', data.error);
                } else {
                    console.error('Gemini API ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜:', data);
                    aiResponseText = 'AI ì‘ë‹µì„ ì²˜ë¦¬í•˜ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê°œë°œì ë„êµ¬ ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                }

                // AI ì‘ë‹µ ë©”ì‹œì§€ í‘œì‹œ (innerHTML ì‚¬ìš©)
                const aiMsgDiv = document.createElement('div');
                aiMsgDiv.classList.add('chat-message', 'ai');
                aiMsgDiv.innerHTML = aiResponseText; // <--- ì´ ë¶€ë¶„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!
                chatBox.appendChild(aiMsgDiv);
                chatBox.scrollTop = chatBox.scrollHeight;

            } catch (error) {
                console.error('Gemini API í˜¸ì¶œ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ:', error);
                chatBox.removeChild(aiLoadingDiv); // ì˜¤ë¥˜ ì‹œ ë¡œë”© ë©”ì‹œì§€ ì œê±°
                const errorMsgDiv = document.createElement('div');
                errorMsgDiv.classList.add('chat-message', 'ai');
                errorMsgDiv.textContent = 'AI ì±—ë´‡ê³¼ ì—°ê²°í•˜ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
                chatBox.appendChild(errorMsgDiv);
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        }

        // ì—”í„° í‚¤ë¡œ ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡
        document.getElementById('chatInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        });

        // ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥ (ë°ì´í„°ëŠ” í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ì´ˆê¸°í™”ë¨)
        let posts = [
            { id: 1, title: 'ë¯¸ë¶„ì´ ë„ˆë¬´ ì–´ë ¤ì›Œìš” ã…œã…œ', content: 'ìˆ˜í•™ í¬ê¸°í•´ë„ ë˜ë‚˜ìš”?', author: 'ìµëª…', likes: 0, comments: [] }
        ];
        let currentViewedPost = null; // í˜„ì¬ ë³´ê³  ìˆëŠ” ê²Œì‹œë¬¼ ë°ì´í„°

        // ê²Œì‹œë¬¼ ëª©ë¡ì„ í™”ë©´ì— ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
        function loadCommunityPosts(filterQuery = '') {
            const communityContent = document.getElementById('communityContent');
            communityContent.innerHTML = ''; // ê¸°ì¡´ ê²Œì‹œë¬¼ ì§€ìš°ê¸°

            const filteredPosts = posts.filter(post =>
                post.title.toLowerCase().includes(filterQuery.toLowerCase()) ||
                post.content.toLowerCase().includes(filterQuery.toLowerCase())
            );

            if (filteredPosts.length === 0) {
                communityContent.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            filteredPosts.forEach(post => {
                const postItem = document.createElement('div');
                postItem.classList.add('post-item');
                postItem.onclick = () => viewPost(post.id); // IDë¡œ ê²Œì‹œë¬¼ ì°¾ê¸°
                postItem.innerHTML = `
                    <h4>${post.title}</h4>
                    <p>${post.content.substring(0, 100)}${post.content.length > 100 ? '...' : ''}</p>
                    <div class="post-meta">ì‘ì„±ì: ${post.author} | ì¢‹ì•„ìš”: ${post.likes}</div>
                `;
                communityContent.appendChild(postItem);
            });
        }

        // ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ ê²€ìƒ‰
        function filterCommunityPosts() {
            const query = document.getElementById('communitySearchQuery').value;
            loadCommunityPosts(query);
        }

        // ì—”í„° í‚¤ë¡œ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ ê²€ìƒ‰
        document.getElementById('communitySearchQuery').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                filterCommunityPosts();
            }
        });

        // ìƒˆ ê¸€ ì‘ì„± ëª¨ë‹¬ ì—´ê¸°
        function openWritePostModal() {
            openModal('writePostModal');
            document.getElementById('postTitle').value = '';
            document.getElementById('postContent').value = '';
        }

        // ìƒˆ ê¸€ ì‘ì„± í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('writePostForm').addEventListener('submit', function(event) {
            event.preventDefault(); // í¼ ì œì¶œ ê¸°ë³¸ ë™ì‘ ë°©ì§€

            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;

            if (!title || !content) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const newPost = {
                id: posts.length > 0 ? Math.max(...posts.map(p => p.id)) + 1 : 1, // ê°„ë‹¨í•œ ID ìƒì„±
                title: title,
                content: content,
                author: 'ìµëª…', // ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì´ë¦„
                likes: 0,
                comments: []
            };

            posts.push(newPost); // ê²Œì‹œë¬¼ ë°°ì—´ì— ì¶”ê°€
            loadCommunityPosts(); // ê²Œì‹œë¬¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            closeModal('writePostModal'); // ê¸€ì“°ê¸° ëª¨ë‹¬ ë‹«ê¸°
            alert('ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
        });

        // ê²Œì‹œë¬¼ ìƒì„¸ ë³´ê¸°
        function viewPost(postId) {
            currentViewedPost = posts.find(p => p.id === postId);
            if (!currentViewedPost) {
                alert('ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            document.getElementById('viewPostTitle').textContent = currentViewedPost.title;
            document.getElementById('viewPostText').textContent = currentViewedPost.content;
            document.getElementById('viewPostMeta').textContent = `ì‘ì„±ì: ${currentViewedPost.author} | ì¢‹ì•„ìš”: ${currentViewedPost.likes}`;
            document.getElementById('likeCount').textContent = currentViewedPost.likes;

            const commentsList = document.getElementById('commentsList');
            commentsList.innerHTML = ''; // ê¸°ì¡´ ëŒ“ê¸€ ì§€ìš°ê¸°

            if (currentViewedPost.comments && currentViewedPost.comments.length > 0) {
                currentViewedPost.comments.forEach(comment => {
                    const commentDiv = document.createElement('div');
                    commentDiv.classList.add('comment-item');
                    commentDiv.innerHTML = `<strong>${comment.author}:</strong> ${comment.text}`;
                    commentsList.appendChild(commentDiv);
                });
            } else {
                // ëŒ“ê¸€ì´ ì—†ì„ ë•Œ ì•Œë¦¼ í‘œì‹œ
                const noCommentsDiv = document.createElement('div');
                noCommentsDiv.id = 'noCommentsAlert'; // ID ì¶”ê°€
                noCommentsDiv.style.cssText = 'color: #666; font-size: 14px; text-align: center; padding: 10px 0;';
                noCommentsDiv.textContent = 'ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.';
                commentsList.appendChild(noCommentsDiv);
            }
            document.getElementById('commentInput').value = ''; // ëŒ“ê¸€ ì…ë ¥ì°½ ì´ˆê¸°í™”
            openModal('viewPostModal');
        }

        // ì¢‹ì•„ìš” ê¸°ëŠ¥
        function likePost() {
            if (!currentViewedPost) return;

            currentViewedPost.likes++;
            document.getElementById('likeCount').textContent = currentViewedPost.likes;
            document.getElementById('viewPostMeta').textContent = `ì‘ì„±ì: ${currentViewedPost.author} | ì¢‹ì•„ìš”: ${currentViewedPost.likes}`;
            alert('ê²Œì‹œë¬¼ì— ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤!');
            loadCommunityPosts(); // ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        }

        // ëŒ“ê¸€ ì¶”ê°€ ê¸°ëŠ¥
        function addComment() {
            if (!currentViewedPost) return;

            const commentInput = document.getElementById('commentInput');
            const commentText = commentInput.value.trim();

            if (!commentText) {
                alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const newComment = { author: 'ìµëª…', text: commentText }; // 'ìµëª…'ì€ ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸ ì •ë³´ë¡œ ëŒ€ì²´
            if (!currentViewedPost.comments) {
                currentViewedPost.comments = [];
            }
            currentViewedPost.comments.push(newComment);

            const commentsList = document.getElementById('commentsList');
            // 'ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤' ì•Œë¦¼ ì œê±°
            const noCommentsAlert = document.getElementById('noCommentsAlert');
            if (noCommentsAlert) {
                commentsList.removeChild(noCommentsAlert);
            }

            const commentDiv = document.createElement('div');
            commentDiv.classList.add('comment-item');
            commentDiv.innerHTML = `<strong>${newComment.author}:</strong> ${newComment.text}`;
            commentsList.appendChild(commentDiv);
            commentInput.value = ''; // ì…ë ¥ì°½ ë¹„ìš°ê¸°
            alert('ëŒ“ê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ì—”í„° í‚¤ë¡œ ëŒ“ê¸€ ì „ì†¡
        document.getElementById('commentInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                addComment();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œë¬¼ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', () => {
            loadCommunityPosts();
        });
    </script>
</body>
</html>
